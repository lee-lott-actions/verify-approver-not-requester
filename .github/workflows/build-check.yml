name: Build Check

on:
  pull_request:
    branches: [ "development","main" ]

jobs:
  tests:
    name: Build Check
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4.2.2

      - name: Install System Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y bats

      - name: Run Unit Tests
        run: bats tests/unit-tests.bats

      - name: Run Integration Tests
        id: integration-tests
        uses: ./
        with:
          requester: 'bob-jones'
          approver: 'john-doe'
          
      - name: Check Integration Test Result
        run: |
          if [[ "${{ steps.integration-tests.outputs.result }}" == "success" ]]  && [[ "${{ steps.integration-tests.outputs.is-approver-not-requester}}" == "true" ]]; then
            echo "Test passed: Integration test simulated successfully."
          else
            echo "Test failed: ${{ steps.create.outputs.error-message }}"
            exit 1
          fi
        shell: bash
